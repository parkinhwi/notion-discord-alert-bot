# ğŸ“‹ Notion To Discord Daily Task Bot

Notion ë°ì´í„°ë² ì´ìŠ¤ì˜ í•  ì¼ì„ Discordë¡œ ìë™ìœ¼ë¡œ ì „ì†¡í•˜ëŠ” ë´‡ì…ë‹ˆë‹¤.  
ë§¤ì¼ ì˜¤ì „ 11ì‹œë¥¼ ê¸°ì¤€ìœ¼ë¡œ ë‚ ì§œê°€ ë°”ë€Œë©°, ì„¤ì •í•œ ì‹œê°„ë§ˆë‹¤ ìë™ìœ¼ë¡œ Discord ë©”ì‹œì§€ë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.

## âœ¨ ì£¼ìš” ê¸°ëŠ¥

- ğŸ”„ **ìë™ ì—…ë°ì´íŠ¸**: 30ë¶„ë§ˆë‹¤ Notion ë°ì´í„°ë¥¼ í™•ì¸í•˜ê³  Discord ë©”ì‹œì§€ ì—…ë°ì´íŠ¸
- ğŸ“… **ìŠ¤ë§ˆíŠ¸ ë‚ ì§œ ê´€ë¦¬**: ì˜¤ì „ 11ì‹œ ê¸°ì¤€ìœ¼ë¡œ "ì˜¤ëŠ˜" í•  ì¼ ìë™ ì„ íƒ
- ğŸ¨ **ì¹´í…Œê³ ë¦¬ë³„ ì •ë¦¬**: ì¹´í…Œê³ ë¦¬1, ì¹´í…Œê³ ë¦¬2, ì¹´í…Œê³ ë¦¬3, ì¹´í…Œê³ ë¦¬4, ì¹´í…Œê³ ë¦¬5 ë¡œ ìë™ ë¶„ë¥˜
- â­ **ìš°ì„ ìˆœìœ„ ì •ë ¬**: ì¤‘ìš”ë„ ìˆœìœ¼ë¡œ ìë™ ì •ë ¬ (1 > 2 > 3 > 4 > -)
- âœ… **ìƒíƒœ í‘œì‹œ**: ì™„ë£Œ(ì·¨ì†Œì„ ), ë³´ë¥˜(ë°‘ì¤„) ìë™ í‘œì‹œ
- ğŸ’¬ **ë©”ì‹œì§€ ì¬ì‚¬ìš©**: ê°™ì€ ë‚ ì§œë©´ ìƒˆ ë©”ì‹œì§€ê°€ ì•„ë‹Œ ê¸°ì¡´ ë©”ì‹œì§€ ìˆ˜ì •

## ğŸ“¸ ë¯¸ë¦¬ë³´ê¸°
<img width="525" height="539" alt="Image" src="https://github.com/user-attachments/assets/72c7a329-e088-44f7-afeb-eda97729eab6" />

ë””ìŠ¤ì½”ë“œì˜ ìŠ¤ë ˆë“œë¥¼ ì´ìš©í•´ì„œ ê¹”ë”í•˜ê²Œ todo ê¸°ë¡ì„ ê´€ë¦¬í•  ìˆ˜ ìˆì–´ìš”.


Discordì— ì´ëŸ° í˜•íƒœë¡œ í‘œì‹œë©ë‹ˆë‹¤:

```
ğŸ“… 2026-01-26

1ï¸âƒ£ ë©”ì¸ì—…ë¬´
(ì§„í–‰ ì¤‘) í”„ë¡œì íŠ¸ A ë§ˆë¬´ë¦¬
~~(ì™„ë£Œ) íšŒì˜ ìë£Œ ì¤€ë¹„~~

2ï¸âƒ£ ì™¸ì£¼
(ì‹œì‘ ì „) í´ë¼ì´ì–¸íŠ¸ ë¯¸íŒ…

3ï¸âƒ£ ìŠ¤í¬í´
í•  ì¼ ì—†ìŒ

4ï¸âƒ£ ìœ íŠœë¸Œ
__(ë³´ë¥˜) ì˜ìƒ í¸ì§‘__

â„¹ï¸ ê¸°íƒ€
(ì§„í–‰ ì¤‘) ë¸”ë¡œê·¸ í¬ìŠ¤íŒ…
```

---

# ğŸš€ ì„¤ì • ê°€ì´ë“œ

## ğŸ“‹ ëª©ì°¨
1. [ì‚¬ì „ ì¤€ë¹„](#1-ì‚¬ì „-ì¤€ë¹„)
2. [Notion ì„¤ì •](#2-notion-ì„¤ì •)
3. [Discord ì›¹í›… ë§Œë“¤ê¸°](#3-discord-ì›¹í›…-ë§Œë“¤ê¸°)
4. [GitHub ë ˆí¬ì§€í† ë¦¬ ë§Œë“¤ê¸°](#4-github-ë ˆí¬ì§€í† ë¦¬-ë§Œë“¤ê¸°)
5. [Notion API ì—°ë™](#5-notion-api-ì—°ë™)
6. [GitHub Secrets ì„¤ì •](#6-github-secrets-ì„¤ì •)
7. [ì™¸ë¶€ ìŠ¤ì¼€ì¤„ëŸ¬ ì„¤ì •](#7-ì™¸ë¶€-ìŠ¤ì¼€ì¤„ëŸ¬-ì„¤ì •-cron-joborg)
8. [í…ŒìŠ¤íŠ¸ ë° í™•ì¸](#8-í…ŒìŠ¤íŠ¸-ë°-í™•ì¸)

---

## 1. ì‚¬ì „ ì¤€ë¹„

### í•„ìš”í•œ ê²ƒë“¤
- [ ] Notion ê³„ì •
- [ ] Discord ì„œë²„ (ê´€ë¦¬ì ê¶Œí•œ)
- [ ] GitHub ê³„ì •
- [ ] ì´ë©”ì¼ ì£¼ì†Œ (Cron-job.org ê°€ì…ìš©)

---

## 2. Notion ì„¤ì •

### 2-1. Notion ë°ì´í„°ë² ì´ìŠ¤ ë§Œë“¤ê¸°
<img width="747" height="479" alt="Image" src="https://github.com/user-attachments/assets/24e6fbdf-f2a5-4ed1-94d7-bbae33aee809" />

1. Notionì—ì„œ ìƒˆ í˜ì´ì§€ ìƒì„±
2. `/table` ì…ë ¥í•˜ì—¬ **Table - Inline** ì„ íƒ
3. ë‹¤ìŒ ì†ì„±(ì»¬ëŸ¼) ì¶”ê°€:

| ì†ì„± ì´ë¦„ | íƒ€ì… | ì„¤ëª… |
|---------|------|------|
| `name` | Title | í•  ì¼ ì œëª© |
| `states` | Status ë˜ëŠ” Select | ìƒíƒœ (ì‹œì‘ ì „ / ì§„í–‰ ì¤‘ / ì™„ë£Œ / ë³´ë¥˜) |
| `label` | Select | ì¹´í…Œê³ ë¦¬ (ë©”ì¸ì—…ë¬´ / ì™¸ì£¼ / ìŠ¤í¬í´ / ìœ íŠœë¸Œ / ê¸°íƒ€) |
| `priority` | Select | ì¤‘ìš”ë„ (-, 1, 2, 3, 4) |
| `date` | Date | ë‚ ì§œ (ë‚ ì§œ ë²”ìœ„ ê°€ëŠ¥) |

### 2-2. ìƒíƒœ ì˜µì…˜ ì„¤ì •

`states` ì†ì„±ì˜ ì˜µì…˜:
- ì‹œì‘ ì „
- ì§„í–‰ ì¤‘
- ì™„ë£Œ
- ë³´ë¥˜

### 2-3. ì¹´í…Œê³ ë¦¬ ì˜µì…˜ ì„¤ì •

`label` ì†ì„±ì˜ ì˜µì…˜:
- ì¹´í…Œê³ ë¦¬1
- ì¹´í…Œê³ ë¦¬2
- ì¹´í…Œê³ ë¦¬3
- ì¹´í…Œê³ ë¦¬4
- ì¹´í…Œê³ ë¦¬5

### 2-4. ìš°ì„ ìˆœìœ„ ì˜µì…˜ ì„¤ì •

`priority` ì†ì„±ì˜ ì˜µì…˜:
- 1
- 2
- 3
- 4
- -

---

## 3. Discord ì›¹í›… ë§Œë“¤ê¸°

### 3-1. ì›¹í›… ìƒì„±

1. Discord ì„œë²„ì—ì„œ ë´‡ì´ ë©”ì‹œì§€ë¥¼ ë³´ë‚¼ **ì±„ë„** ì„ íƒ
2. ì±„ë„ ì„¤ì • (âš™ï¸) â†’ **ì—°ë™** â†’ **ì›¹í›„í¬**
3. **ìƒˆ ì›¹í›„í¬** í´ë¦­
4. ì›¹í›„í¬ ì´ë¦„ ì„¤ì • (ì˜ˆ: `Notion Bot`)
5. **ì›¹í›„í¬ URL ë³µì‚¬** í´ë¦­í•˜ì—¬ URL ë³µì‚¬
6. **ì €ì¥** í´ë¦­

### 3-2. ì›¹í›… URL í˜•ì‹ í™•ì¸

ë³µì‚¬í•œ URLì€ ë‹¤ìŒê³¼ ê°™ì€ í˜•ì‹ì´ì–´ì•¼ í•©ë‹ˆë‹¤:
```
https://discord.com/api/webhooks/123456789/abcdefghijklmnop
```

> âš ï¸ **ì¤‘ìš”**: ì´ URLì€ ì ˆëŒ€ ê³µê°œí•˜ì§€ ë§ˆì„¸ìš”!

---

## 4. GitHub ë ˆí¬ì§€í† ë¦¬ ë§Œë“¤ê¸°

### 4-1. ë ˆí¬ì§€í† ë¦¬ ìƒì„±

1. https://github.com ì ‘ì† ë° ë¡œê·¸ì¸
2. ì˜¤ë¥¸ìª½ ìœ„ **+** â†’ **New repository** í´ë¦­
3. ì„¤ì •:
   - Repository name: `notion-discord-alert-bot` (ì›í•˜ëŠ” ì´ë¦„)
   - Public ë˜ëŠ” Private ì„ íƒ (ë‘˜ ë‹¤ ê°€ëŠ¥)
   - **Add a README file** ì²´í¬
4. **Create repository** í´ë¦­

### 4-2. íŒŒì¼ ì—…ë¡œë“œ

ë ˆí¬ì§€í† ë¦¬ì— ë‹¤ìŒ íŒŒì¼ë“¤ì„ ì¶”ê°€í•˜ì„¸ìš”:

**1) `.github/workflows/notify.yml`**

ë¨¼ì € í´ë” êµ¬ì¡°ë¥¼ ë§Œë“¤ì–´ì•¼ í•©ë‹ˆë‹¤:
- **Add file** â†’ **Create new file**
- íŒŒì¼ ì´ë¦„ì— `.github/workflows/notify.yml` ì…ë ¥ (ìë™ìœ¼ë¡œ í´ë” ìƒì„±ë¨)

ë‚´ìš©:
```yaml
name: Notion to Discord Notification

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  notify:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.x"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install requests

      - name: Run notification script
        env:
          NOTION_API_KEY: ${{ secrets.NOTION_API_KEY }}
          NOTION_DATABASE_ID: ${{ secrets.NOTION_DATABASE_ID }}
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: python script.py

      - name: Commit and Push
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          git add discord_state.json
          if ! git diff --cached --quiet; then
            git commit -m "Update discord message state [skip ci]"
            git pull origin main --no-rebase || true
            git push origin main || echo "Push failed, but continuing..."
          fi
```

**Commit changes** í´ë¦­

**2) `script.py`**

- **Add file** â†’ **Create new file**
- íŒŒì¼ ì´ë¦„: `script.py`

ë‚´ìš©:
```python
import os
import json
import requests
from datetime import datetime, timezone, timedelta
import re


KST = timezone(timedelta(hours=9))
ROLLOVER_HOUR = 11  # ì˜¤ì „ 11ì‹œ ê¸°ì¤€

def kst_now():
    return datetime.now(KST)

def effective_date(now=None):
    """
    ì˜¤ì „ 11ì‹œ ì „ì´ë©´ 'ì–´ì œ', 11ì‹œ(í¬í•¨) ì´í›„ë©´ 'ì˜¤ëŠ˜'ì„ ë°˜í™˜
    """
    now = now or kst_now()
    base = now.date()
    if now.hour < ROLLOVER_HOUR:
        base = base - timedelta(days=1)
    return base

def effective_date_str(now=None):
    return effective_date(now).strftime("%Y-%m-%d")


# ==============================
# âœ… Notion ì†ì„± ì´ë¦„ (DBì— ë³´ì´ëŠ” ì»¬ëŸ¼ ì´ë¦„ ê·¸ëŒ€ë¡œ)
# ==============================
TITLE_PROP = "name"         # title
STATUS_PROP = "states"      # status: ì‹œì‘ ì „ / ì§„í–‰ ì¤‘ / ì™„ë£Œ / ë³´ë¥˜
CATEGORY_PROP = "label"     # select: (ë„¤ DBì— ë§ê²Œ)
PRIORITY_PROP = "priority"  # select: -, 1, 2, 3, 4
DATE_PROP = "date"          # date

# ==============================
# âœ… ì¹´í…Œê³ ë¦¬ ì¶œë ¥ ìˆœì„œ + ì•„ì´ì½˜
# ==============================
CATEGORY_ORDER = [
    ("ì¹´í…Œê³ ë¦¬1", "1ï¸âƒ£"),
    ("ì¹´í…Œê³ ë¦¬2", "2ï¸âƒ£"),
    ("ì¹´í…Œê³ ë¦¬3", "3ï¸âƒ£"),
    ("ì¹´í…Œê³ ë¦¬4", "4ï¸âƒ£"),
    ("ì¹´í…Œê³ ë¦¬5", "â„¹ï¸"),
]

# âœ… ì¤‘ìš”ë„ ì •ë ¬ ìˆœì„œ (1ì´ ê°€ì¥ ì¤‘ìš”)
PRIORITY_ORDER = ["1", "2", "3", "4", "-"]

# âœ… ë””ìŠ¤ì½”ë“œ ì„ë² ë“œ ì»¬ëŸ¬ (FF57CF)
EMBED_COLOR = int("FF57CF", 16)

# âœ… ë©”ì‹œì§€ ID ì €ì¥ íŒŒì¼
STATE_FILE = "discord_state.json"


def normalize_notion_db_id(raw: str) -> str:
    if not raw:
        return ""
    raw = raw.strip()
    m = re.search(r"[0-9a-fA-F]{32}", raw.replace("-", ""))
    if m:
        return m.group(0)
    raw2 = raw.replace("-", "")
    if re.fullmatch(r"[0-9a-fA-F]{32}", raw2):
        return raw2
    return raw


# ==============================
# âœ… STATE ì €ì¥/ë¡œë“œ
# ==============================
def load_state():
    if not os.path.exists(STATE_FILE):
        return {}
    try:
        with open(STATE_FILE, "r", encoding="utf-8") as f:
            return json.load(f)
    except Exception:
        return {}


def save_state(state: dict):
    with open(STATE_FILE, "w", encoding="utf-8") as f:
        json.dump(state, f, ensure_ascii=False, indent=2)


# ==============================
# âœ… Notion ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
# ==============================
def fetch_notion_data():
    notion_api_key = os.getenv("NOTION_API_KEY")
    database_id_raw = os.getenv("NOTION_DATABASE_ID")
    database_id = normalize_notion_db_id(database_id_raw)

    if not notion_api_key or not database_id:
        raise ValueError("NOTION_API_KEY ë˜ëŠ” NOTION_DATABASE_IDê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.")

    url = f"https://api.notion.com/v1/databases/{database_id}/query"

    headers = {
        "Authorization": f"Bearer {notion_api_key}",
        "Notion-Version": "2022-06-28",
        "Content-Type": "application/json",
    }

    all_results = []
    start_cursor = None

    # date ë¹„ì–´ìˆì§€ ì•Šì€ ê²ƒë§Œ ì „ì²´ ì¡°íšŒ(í˜ì´ì§€ë„¤ì´ì…˜)
    while True:
        payload = {
            "page_size": 100,
            "filter": {
                "property": DATE_PROP,
                "date": {"is_not_empty": True}
            }
        }

        if start_cursor:
            payload["start_cursor"] = start_cursor

        response = requests.post(url, headers=headers, json=payload)
        response.raise_for_status()
        data = response.json()

        all_results.extend(data.get("results", []))

        if data.get("has_more"):
            start_cursor = data.get("next_cursor")
        else:
            break

    return {"results": all_results}


def safe_get_title(page):
    title_arr = page["properties"][TITLE_PROP]["title"]
    if not title_arr:
        return None
    return title_arr[0]["plain_text"]


def safe_get_select_name(page, prop_name):
    prop = page["properties"].get(prop_name)
    if not prop:
        return None
    if prop["type"] == "select":
        return prop["select"]["name"] if prop["select"] else None
    return None


def safe_get_status_name(page):
    prop = page["properties"].get(STATUS_PROP)
    if not prop:
        return None

    # Notion 'Status' íƒ€ì…
    if prop["type"] == "status":
        return prop["status"]["name"] if prop["status"] else None

    # Notion 'Select' íƒ€ì…
    if prop["type"] == "select":
        return prop["select"]["name"] if prop["select"] else None

    return None


def parse_date_yyyy_mm_dd(s: str):
    if not s:
        return None
    try:
        return datetime.strptime(s[:10], "%Y-%m-%d").date()
    except Exception:
        return None


def safe_get_date_range(page):
    prop = page["properties"].get(DATE_PROP)
    if not prop:
        return (None, None)

    if prop["type"] == "date" and prop["date"]:
        start_raw = prop["date"].get("start")
        end_raw = prop["date"].get("end")

        start_d = parse_date_yyyy_mm_dd(start_raw)
        end_d = parse_date_yyyy_mm_dd(end_raw) if end_raw else None

        # endê°€ ì—†ìœ¼ë©´ start í•˜ë£¨ì§œë¦¬ë¡œ ì·¨ê¸‰
        if start_d and not end_d:
            end_d = start_d

        return (start_d, end_d)

    return (None, None)


def priority_rank(priority_value):
    if priority_value in PRIORITY_ORDER:
        return PRIORITY_ORDER.index(priority_value)
    return len(PRIORITY_ORDER)


# ==============================
# âœ… ì¶œë ¥ í¬ë§·
#   - ì™„ë£Œ: ì·¨ì†Œì„ 
#   - ë³´ë¥˜: ë°‘ì¤„(underline)
# ==============================
def format_task_line(title, status):
    s = status if status else "ì‹œì‘ ì „"
    line = f"({s}) {title}"

    if s == "ì™„ë£Œ":
        line = f"~~{line}~~"
    elif s == "ë³´ë¥˜":
        line = f"__{line}__"

    return line


def group_tasks_for_date(data, target_date):
    grouped = {cat: [] for cat, _ in CATEGORY_ORDER}

    for page in data.get("results", []):
        start_d, end_d = safe_get_date_range(page)
        if not start_d or not end_d:
            continue

        if not (start_d <= target_date <= end_d):
            continue

        title = safe_get_title(page)
        if not title:
            continue

        status = safe_get_status_name(page)
        category = safe_get_select_name(page, CATEGORY_PROP)
        priority = safe_get_select_name(page, PRIORITY_PROP)

        if category not in grouped:
            category = "ê¸°íƒ€"

        grouped[category].append((priority, status, title))

    for cat in grouped:
        grouped[cat].sort(key=lambda x: priority_rank(x[0]))

    return grouped


def create_discord_payload(data, eff_str):
    eff_date = datetime.strptime(eff_str, "%Y-%m-%d").date()
    grouped = group_tasks_for_date(data, eff_date)

    lines = [f"ğŸ“… **{eff_str}**", ""]

    for idx, (cat, icon) in enumerate(CATEGORY_ORDER):
        lines.append(f"{icon} **{cat}**")
        items = grouped.get(cat, [])
        if not items:
            lines.append("í•  ì¼ ì—†ìŒ")
        else:
            for (_, s, t) in items:
                lines.append(format_task_line(title=t, status=s))
        if idx != len(CATEGORY_ORDER) - 1:
            lines.append("")

    return {
        "embeds": [{
            "description": "\n".join(lines),
            "color": EMBED_COLOR
        }]
    }


# ==============================
# âœ… Discord ì „ì†¡ / ìˆ˜ì •
# ==============================
def clean_webhook_url(url: str) -> str:
    return url.split("?")[0].strip()

def send_new_message(webhook_url, payload):
    base = clean_webhook_url(webhook_url)
    r = requests.post(base, params={"wait": "true"}, json=payload)
    r.raise_for_status()
    return r.json()["id"]

def edit_message(webhook_url, message_id, payload):
    base = clean_webhook_url(webhook_url)
    url = f"{base}/messages/{message_id}"
    r = requests.patch(url, json=payload)
    r.raise_for_status()
    return True


def main():
    webhook_url = os.getenv("DISCORD_WEBHOOK_URL")
    if not webhook_url:
        raise ValueError("DISCORD_WEBHOOK_URLì´ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.")

    eff = effective_date_str()  # 11ì‹œ ê¸°ì¤€ ë‚ ì§œ

    notion_data = fetch_notion_data()
    payload = create_discord_payload(notion_data, eff)

    state = load_state()
    saved_date = state.get("date")
    saved_message_id = state.get("message_id")

    if saved_date == eff and saved_message_id:
        edit_message(webhook_url, saved_message_id, payload)
        print(f"âœ… Edited message: {saved_message_id}")
    else:
        new_id = send_new_message(webhook_url, payload)
        state = {"date": eff, "message_id": new_id}
        save_state(state)
        print(f"âœ… Created new message: {new_id}")


if __name__ == "__main__":
    main()
```

**Commit changes** í´ë¦­

**3) `.gitignore`**

- **Add file** â†’ **Create new file**
- íŒŒì¼ ì´ë¦„: `.gitignore`

ë‚´ìš©:
```
.env
__pycache__/
*.pyc
.DS_Store
```

**Commit changes** í´ë¦­

**4) `discord_state.json`** (ì„ íƒì‚¬í•­)

- **Add file** â†’ **Create new file**
- íŒŒì¼ ì´ë¦„: `discord_state.json`

ë‚´ìš©:
```json
{
  "date": "",
  "message_id": ""
}
```

**Commit changes** í´ë¦­

---

## 5. Notion API ì—°ë™

### 5-1. Notion Integration ë§Œë“¤ê¸°

1. https://www.notion.so/my-integrations ì ‘ì†
2. **+ New integration** í´ë¦­
3. ì„¤ì •:
   - Name: `Discord Bot` (ì›í•˜ëŠ” ì´ë¦„)
   - Associated workspace: ë³¸ì¸ì˜ ì›Œí¬ìŠ¤í˜ì´ìŠ¤ ì„ íƒ
   - Type: **Internal**
4. **Submit** í´ë¦­
5. **Internal Integration Token** ë³µì‚¬ (ë‚˜ì¤‘ì— ì‚¬ìš©)
   - í˜•ì‹: `secret_xxxxxxxxxxxxxxxxxxxxx`

### 5-2. Databaseì— Integration ì—°ê²°

1. Notionì—ì„œ ë§Œë“  ë°ì´í„°ë² ì´ìŠ¤ í˜ì´ì§€ ì—´ê¸°
2. ì˜¤ë¥¸ìª½ ìœ„ **â‹¯** (ì  3ê°œ) â†’ **ì—°ê²°** â†’ **ì—°ê²° ì¶”ê°€**
3. ë°©ê¸ˆ ë§Œë“  Integration (`Discord Bot`) ì„ íƒ
4. **í™•ì¸** í´ë¦­

### 5-3. Database ID ë³µì‚¬

1. ë°ì´í„°ë² ì´ìŠ¤ í˜ì´ì§€ ì—´ê¸°
2. ì£¼ì†Œì°½ì˜ URL ë³µì‚¬

URL í˜•ì‹:
```
https://www.notion.so/xxxxxxxxxxxxxxxxxxxxxxxxxxxx?v=yyyyyyyyyyyyyyyyyyyyyy
```

Database IDëŠ” URLì—ì„œ `?` ì•ë¶€ë¶„:
```
xxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

ë˜ëŠ” ì „ì²´ URLì„ ë³µì‚¬í•´ë„ ë©ë‹ˆë‹¤ (ìŠ¤í¬ë¦½íŠ¸ê°€ ìë™ìœ¼ë¡œ ID ì¶”ì¶œ).

---

## 6. GitHub Secrets ì„¤ì •

### 6-1. Secrets ì¶”ê°€

1. GitHub ë ˆí¬ì§€í† ë¦¬ â†’ **Settings** íƒ­
2. ì™¼ìª½ **Secrets and variables** â†’ **Actions**
3. **New repository secret** í´ë¦­

### 6-2. 3ê°œì˜ Secret ì¶”ê°€

**Secret 1: NOTION_API_KEY**
```
Name: NOTION_API_KEY
Value: secret_xxxxxxxxxxxxxxxxxxxx (5-1ì—ì„œ ë³µì‚¬í•œ Integration Token)
```
**Add secret** í´ë¦­

**Secret 2: NOTION_DATABASE_ID**
```
Name: NOTION_DATABASE_ID
Value: xxxxxxxxxxxxxxxxxxxxxxxxxxxx (5-3ì—ì„œ ë³µì‚¬í•œ Database ID ë˜ëŠ” ì „ì²´ URL)
```
**Add secret** í´ë¦­

**Secret 3: DISCORD_WEBHOOK_URL**
```
Name: DISCORD_WEBHOOK_URL
Value: https://discord.com/api/webhooks/... (3-1ì—ì„œ ë³µì‚¬í•œ ì›¹í›… URL)
```
**Add secret** í´ë¦­

### 6-3. í™•ì¸

Secrets ëª©ë¡ì— ë‹¤ìŒ 3ê°œê°€ ìˆì–´ì•¼ í•©ë‹ˆë‹¤:
- âœ… NOTION_API_KEY
- âœ… NOTION_DATABASE_ID
- âœ… DISCORD_WEBHOOK_URL

---

## 7. ì™¸ë¶€ ìŠ¤ì¼€ì¤„ëŸ¬ ì„¤ì • (Cron-job.org)

GitHub Actionsì˜ ìŠ¤ì¼€ì¤„ì€ ë¶ˆì•ˆì •í•˜ë¯€ë¡œ ì™¸ë¶€ ìŠ¤ì¼€ì¤„ëŸ¬ë¥¼ ì‚¬ìš©í•©ë‹ˆë‹¤.

### 7-1. GitHub Personal Access Token ë§Œë“¤ê¸°

1. GitHub ì˜¤ë¥¸ìª½ ìœ„ **í”„ë¡œí•„ ì‚¬ì§„** â†’ **Settings**
2. ì™¼ìª½ ë§¨ ì•„ë˜ **Developer settings**
3. **Personal access tokens** â†’ **Tokens (classic)**
4. **Generate new token** â†’ **Generate new token (classic)**
5. ì„¤ì •:
   - Note: `Cron Job for Notion Discord Bot`
   - Expiration: **No expiration**
   - Select scopes:
     - âœ… **repo** (ì „ì²´ ì²´í¬)
     - âœ… **workflow**
6. **Generate token** í´ë¦­
7. ìƒì„±ëœ í† í° ë³µì‚¬ (ì˜ˆ: `ghp_xxxxxxxxxxxx`)
   - âš ï¸ **ì¤‘ìš”**: ì´ í˜ì´ì§€ë¥¼ ë²—ì–´ë‚˜ë©´ ë‹¤ì‹œ ë³¼ ìˆ˜ ì—†ìœ¼ë‹ˆ ë°”ë¡œ ë³µì‚¬í•˜ì„¸ìš”!

### 7-2. Cron-job.org ê°€ì…

1. https://cron-job.org ì ‘ì†
2. **Sign up** í´ë¦­
3. ì´ë©”ì¼, ë¹„ë°€ë²ˆí˜¸ ì…ë ¥
4. ì´ë©”ì¼ ì¸ì¦ ì™„ë£Œ

### 7-3. Cron Job ë§Œë“¤ê¸°

1. ë¡œê·¸ì¸ í›„ **Create cronjob** í´ë¦­

#### COMMON íƒ­:

**Title:**
```
Notion Discord Bot - Every 30 minutes
```

**URL:**
```
https://api.github.com/repos/ë³¸ì¸GitHubì•„ì´ë””/ë ˆí¬ì´ë¦„/actions/workflows/notify.yml/dispatches
```

ì˜ˆì‹œ:
```
https://api.github.com/repos/parkinhwi/notion-discord-alert-bot/actions/workflows/notify.yml/dispatches
```

**Enable job:** âœ… ì²´í¬

**Execution schedule:**
- **Every 30 minutes** ì„ íƒ

ë˜ëŠ” Custom:
```
Minutes: */30
Hours: *
Days: *
Months: *
Weekdays: *
```

#### ADVANCED íƒ­:

**Request method:**
```
POST
```

**Headers** (+ Add header ë²„íŠ¼ 4ë²ˆ í´ë¦­):

Header 1:
```
Name: Accept
Value: application/vnd.github+json
```

Header 2:
```
Name: Authorization
Value: Bearer ghp_xxxxxxxxxxxxxxxxx
```
âš ï¸ `Bearer ` ë‹¤ìŒì— ê³µë°± 1ì¹¸ + 7-1ì—ì„œ ë³µì‚¬í•œ í† í°

Header 3:
```
Name: X-GitHub-Api-Version
Value: 2022-11-28
```

Header 4:
```
Name: Content-Type
Value: application/json
```

**Body:**
```json
{"ref":"main"}
```

2. **CREATE** í´ë¦­

### 7-4. í…ŒìŠ¤íŠ¸

1. ìƒì„±ëœ í¬ë¡ ì¡ ëª©ë¡ì—ì„œ ì°¾ê¸°
2. ì˜¤ë¥¸ìª½ **â–¶ï¸ Run** í´ë¦­
3. "Job has been executed successfully" ë©”ì‹œì§€ í™•ì¸

---

## 8. í…ŒìŠ¤íŠ¸ ë° í™•ì¸

### 8-1. GitHub Actions í™•ì¸

1. GitHub ë ˆí¬ì§€í† ë¦¬ â†’ **Actions** íƒ­
2. ìƒˆ ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ í™•ì¸
   - Event: **workflow_dispatch**
   - ìƒíƒœ: ì´ˆë¡ìƒ‰ ì²´í¬ âœ…

### 8-2. Discord í™•ì¸

Discord ì±„ë„ì—ì„œ ë´‡ ë©”ì‹œì§€ í™•ì¸:
- ğŸ“… ë‚ ì§œ í‘œì‹œ
- ì¹´í…Œê³ ë¦¬ë³„ í•  ì¼ ëª©ë¡
- ìƒíƒœ í‘œì‹œ (ì™„ë£ŒëŠ” ì·¨ì†Œì„ , ë³´ë¥˜ëŠ” ë°‘ì¤„)

### 8-3. ìˆ˜ë™ í…ŒìŠ¤íŠ¸

ì–¸ì œë“ ì§€ ìˆ˜ë™ìœ¼ë¡œ ì‹¤í–‰ ê°€ëŠ¥:
1. GitHub â†’ Actions íƒ­
2. ì™¼ìª½ "Notion to Discord Notification" í´ë¦­
3. **Run workflow** â†’ **Run workflow** í´ë¦­

---

## âš™ï¸ ì»¤ìŠ¤í„°ë§ˆì´ì§•

### ì¹´í…Œê³ ë¦¬ ë³€ê²½

`script.py`ì˜ `CATEGORY_ORDER` ìˆ˜ì •:

```python
CATEGORY_ORDER = [
    ("ì—…ë¬´", "ğŸ’¼"),
    ("ê°œì¸", "ğŸ‘¤"),
    ("ê³µë¶€", "ğŸ“š"),
]
```

### ì‹¤í–‰ ì‹œê°„ ë³€ê²½

Cron-job.orgì—ì„œ:
- 1ì‹œê°„ë§ˆë‹¤: `0 * * * *`
- 30ë¶„ë§ˆë‹¤: `*/30 * * * *`
- ë§¤ì¼ ì˜¤ì „ 9ì‹œ: `0 9 * * *`

### ë‚ ì§œ ê¸°ì¤€ ì‹œê°„ ë³€ê²½

`script.py`ì˜ `ROLLOVER_HOUR` ìˆ˜ì •:

```python
ROLLOVER_HOUR = 9  # ì˜¤ì „ 9ì‹œ ê¸°ì¤€ìœ¼ë¡œ ë³€ê²½
```

### ì„ë² ë“œ ìƒ‰ìƒ ë³€ê²½

`script.py`ì˜ `EMBED_COLOR` ìˆ˜ì •:

```python
EMBED_COLOR = int("FF5733", 16)  # ì£¼í™©ìƒ‰
EMBED_COLOR = int("3498DB", 16)  # íŒŒë€ìƒ‰
EMBED_COLOR = int("2ECC71", 16)  # ì´ˆë¡ìƒ‰
```

---

## ğŸ”§ ë¬¸ì œ í•´ê²°

### ì›Œí¬í”Œë¡œìš°ê°€ ì‹¤í–‰ë˜ì§€ ì•Šì•„ìš”
- GitHub Secrets 3ê°œê°€ ëª¨ë‘ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸
- Cron-job.orgì—ì„œ ìˆ˜ë™ ì‹¤í–‰(â–¶ï¸) í…ŒìŠ¤íŠ¸
- GitHub Actions íƒ­ì—ì„œ ì˜¤ë¥˜ ë¡œê·¸ í™•ì¸

### Discordì— ë©”ì‹œì§€ê°€ ì•ˆ ë³´ì—¬ìš”
- Discord ì›¹í›… URLì´ ì˜¬ë°”ë¥¸ì§€ í™•ì¸
- ì›¹í›…ì´ ìƒì„±ëœ ì±„ë„ í™•ì¸
- GitHub Actions ë¡œê·¸ì—ì„œ ì˜¤ë¥˜ í™•ì¸

### Notion ë°ì´í„°ë¥¼ ëª» ê°€ì ¸ì™€ìš”
- Notion Integrationì´ ë°ì´í„°ë² ì´ìŠ¤ì— ì—°ê²°ë˜ì—ˆëŠ”ì§€ í™•ì¸
- Database IDê°€ ì˜¬ë°”ë¥¸ì§€ í™•ì¸
- Notion ì†ì„± ì´ë¦„ì´ ì½”ë“œì™€ ì¼ì¹˜í•˜ëŠ”ì§€ í™•ì¸

### "404 Not Found" ì˜¤ë¥˜
- Cron-job.orgì˜ URLì—ì„œ ë ˆí¬ ì´ë¦„, ì‚¬ìš©ì ì´ë¦„ í™•ì¸
- `notify.yml` íŒŒì¼ ì´ë¦„ í™•ì¸

---

## ğŸ“ ë¼ì´ì„ ìŠ¤

MIT License

---

## ğŸ¤ ê¸°ì—¬

ì´ìŠˆë‚˜ ê°œì„  ì‚¬í•­ì´ ìˆìœ¼ë©´ ììœ ë¡­ê²Œ Issueë¥¼ ì—´ì–´ì£¼ì„¸ìš”!

---

## ğŸ“§ ë¬¸ì˜

ë¬¸ì œê°€ ìˆìœ¼ì‹œë©´ GitHub Issuesì— ë‚¨ê²¨ì£¼ì„¸ìš”.

---

**Made with â¤ï¸ for Notion & Discord users**
